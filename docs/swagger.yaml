swagger: "2.0"
info:
  description: "API Documentation for Keerja Backend. This documentation covers all available endpoints for the Keerja platform, including authentication, user management, job postings, applications, company management, and admin features."
  version: "1.0.0"
  title: "Keerja Backend API"
  contact:
    email: "dev@keerja.com"
host: "localhost:8080"
basePath: "/api/v1"
tags:
  - name: "Auth"
    description: "Authentication and Authorization"
  - name: "User"
    description: "User Profile and Management"
  - name: "Job"
    description: "Job Posting and Search"
  - name: "Application"
    description: "Job Applications Management"
  - name: "Company"
    description: "Company Profile and Management"
  - name: "Master"
    description: "Master Data (Locations, Industries, Skills)"
  - name: "Admin"
    description: "Admin Dashboard and Moderation"
  - name: "Notification"
    description: "Push Notifications and Device Tokens"
  - name: "Chat"
    description: "Messaging and Conversations"

schemes:
  - "http"
  - "https"

securityDefinitions:
  Bearer:
    type: "apiKey"
    name: "Authorization"
    in: "header"
    description: "Enter your Bearer token in the format **Bearer &lt;token&gt;**"

paths:
  # ==========================================================
  # AUTH ENDPOINTS
  # ==========================================================
  /auth/register:
    post:
      tags: ["Auth"]
      summary: "Register a new user"
      description: "Register a new user (jobseeker or employer) with email and password."
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/RegisterRequest"
      responses:
        201:
          description: "User registered successfully"
        400:
          description: "Invalid input"

  /auth/login:
    post:
      tags: ["Auth"]
      summary: "Login"
      description: "Authenticate user and return access token."
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/LoginRequest"
      responses:
        200:
          description: "Login successful"
          schema:
            $ref: "#/definitions/AuthResponse"
        401:
          description: "Invalid credentials"

  /auth/refresh-token:
    post:
      tags: ["Auth"]
      summary: "Refresh Access Token"
      description: "Get a new access token using a refresh token."
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/RefreshTokenRequest"
      responses:
        200:
          description: "Token refreshed"
          schema:
            $ref: "#/definitions/AuthResponse"

  /auth/logout:
    post:
      tags: ["Auth"]
      summary: "Logout"
      security:
        - Bearer: []
      responses:
        200:
          description: "Logged out successfully"

  # ==========================================================
  # USER ENDPOINTS
  # ==========================================================
  /users/me:
    get:
      tags: ["User"]
      summary: "Get My Profile"
      security:
        - Bearer: []
      responses:
        200:
          description: "User profile data"
          schema:
            $ref: "#/definitions/UserProfile"
    put:
      tags: ["User"]
      summary: "Update My Profile"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/UpdateProfileRequest"
      responses:
        200:
          description: "Profile updated"

  /users/me/preferences:
    get:
      tags: ["User"]
      summary: "Get User Preferences"
      security:
        - Bearer: []
      responses:
        200:
          description: "User preferences"
    put:
      tags: ["User"]
      summary: "Update User Preferences"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            type: object
            properties:
              job_types:
                type: array
                items:
                  type: integer
              locations:
                type: array
                items:
                  type: integer
      responses:
        200:
          description: "Preferences updated"

  # ==========================================================
  # JOB ENDPOINTS
  # ==========================================================
  /jobs:
    get:
      tags: ["Job"]
      summary: "List Jobs"
      description: "Get a list of jobs with filters."
      parameters:
        - in: "query"
          name: "page"
          type: "integer"
        - in: "query"
          name: "limit"
          type: "integer"
        - in: "query"
          name: "q"
          type: "string"
          description: "Search query"
      responses:
        200:
          description: "List of jobs"
    post:
      tags: ["Job"]
      summary: "Create Job"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/CreateJobRequest"
      responses:
        201:
          description: "Job created"

  /jobs/{id}:
    get:
      tags: ["Job"]
      summary: "Get Job Details"
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
      responses:
        200:
          description: "Job details"
    put:
      tags: ["Job"]
      summary: "Update Job"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/UpdateJobRequest"
      responses:
        200:
          description: "Job updated"
    delete:
      tags: ["Job"]
      summary: "Delete Job"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
      responses:
        200:
          description: "Job deleted"

  /jobs/draft:
    post:
      tags: ["Job"]
      summary: "Save Job Draft"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/SaveJobDraftRequest"
      responses:
        200:
          description: "Draft saved"

  # ==========================================================
  # APPLICATION ENDPOINTS
  # ==========================================================
  /applications:
    post:
      tags: ["Application"]
      summary: "Submit Application"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/ApplyRequest"
      responses:
        201:
          description: "Application submitted"

  /applications/my-applications:
    get:
      tags: ["Application"]
      summary: "My Applications"
      security:
        - Bearer: []
      responses:
        200:
          description: "List of applications"

  /applications/{id}/status:
    patch:
      tags: ["Application"]
      summary: "Update Application Status"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            type: object
            properties:
              status:
                type: string
                enum: ["pending", "reviewing", "shortlisted", "rejected", "accepted"]
              reason:
                type: string
      responses:
        200:
          description: "Status updated"

  # ==========================================================
  # COMPANY ENDPOINTS
  # ==========================================================
  /companies:
    get:
      tags: ["Company"]
      summary: "List Companies"
      responses:
        200:
          description: "List of companies"
    post:
      tags: ["Company"]
      summary: "Register Company"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/RegisterCompanyRequest"
      responses:
        201:
          description: "Company registered"

  /companies/{id}:
    get:
      tags: ["Company"]
      summary: "Get Company Details"
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
      responses:
        200:
          description: "Company details"
    put:
      tags: ["Company"]
      summary: "Update Company"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/UpdateCompanyRequest"
      responses:
        200:
          description: "Company updated"

  /companies/my-companies:
    get:
      tags: ["Company"]
      summary: "Get My Companies"
      security:
        - Bearer: []
      responses:
        200:
          description: "List of user's companies"

  # ==========================================================
  # CHAT ENDPOINTS
  # ==========================================================
  /chat/conversations:
    get:
      tags: ["Chat"]
      summary: "Get Conversations"
      security:
        - Bearer: []
      responses:
        200:
          description: "List of conversations"
    post:
      tags: ["Chat"]
      summary: "Start Conversation"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/CreateConversationRequest"
      responses:
        201:
          description: "Conversation created"

  /chat/conversations/{id}/messages:
    get:
      tags: ["Chat"]
      summary: "Get Messages"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "string"
      responses:
        200:
          description: "List of messages"
    post:
      tags: ["Chat"]
      summary: "Send Message"
      security:
        - Bearer: []
      parameters:
        - in: "path"
          name: "id"
          required: true
          type: "string"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/SendMessageRequest"
      responses:
        201:
          description: "Message sent"

  # ==========================================================
  # NOTIFICATION ENDPOINTS
  # ==========================================================
  /device-tokens:
    post:
      tags: ["Notification"]
      summary: "Register Device Token"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/RegisterDeviceTokenRequest"
      responses:
        201:
          description: "Token registered"

  /push/send/device:
    post:
      tags: ["Notification"]
      summary: "Send Push to Device"
      security:
        - Bearer: []
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/SendPushToDeviceRequest"
      responses:
        200:
          description: "Notification sent"

definitions:
  # Auth Definitions
  LoginRequest:
    type: object
    required:
      - email
      - password
    properties:
      email:
        type: string
        example: "user@example.com"
      password:
        type: string
        example: "secret123"
  
  RegisterRequest:
    type: object
    required:
      - email
      - password
      - full_name
      - user_type
    properties:
      email:
        type: string
      password:
        type: string
      full_name:
        type: string
      phone:
        type: string
      user_type:
        type: string
        enum: ["jobseeker", "employer"]

  RefreshTokenRequest:
    type: object
    required:
      - refresh_token
    properties:
      refresh_token:
        type: string

  AuthResponse:
    type: object
    properties:
      access_token:
        type: string
      refresh_token:
        type: string
      expires_in:
        type: integer

  # User Definitions
  UserProfile:
    type: object
    properties:
      id:
        type: integer
      email:
        type: string
      full_name:
        type: string
      avatar_url:
        type: string

  UpdateProfileRequest:
    type: object
    properties:
      full_name:
        type: string
      bio:
        type: string
      phone:
        type: string

  # Job Definitions
  CreateJobRequest:
    type: object
    required:
      - company_id
      - description
      - job_type_id
      - work_policy_id
    properties:
      company_id:
        type: integer
      description:
        type: string
      job_category_id:
        type: integer
      job_title_id:
        type: integer
      job_type_id:
        type: integer
      work_policy_id:
        type: integer
      salary_min:
        type: number
      salary_max:
        type: number
      skills:
        type: array
        items:
          $ref: "#/definitions/AddSkillRequest"

  AddSkillRequest:
    type: object
    properties:
      skill_id:
        type: integer
      importance_level:
        type: string

  UpdateJobRequest:
    type: object
    properties:
      description:
        type: string
      salary_min:
        type: number
      salary_max:
        type: number

  SaveJobDraftRequest:
    type: object
    properties:
      company_id:
        type: integer
      description:
        type: string

  # Application Definitions
  ApplyRequest:
    type: object
    required:
      - job_id
    properties:
      job_id:
        type: integer
      cover_letter:
        type: string
      resume_url:
        type: string

  # Company Definitions
  RegisterCompanyRequest:
    type: object
    required:
      - company_name
    properties:
      company_name:
        type: string
      industry_id:
        type: integer
      description:
        type: string

  UpdateCompanyRequest:
    type: object
    properties:
      company_name:
        type: string
      description:
        type: string
      website_url:
        type: string

  # Chat Definitions
  CreateConversationRequest:
    type: object
    required:
      - recipient_id
    properties:
      recipient_id:
        type: integer

  SendMessageRequest:
    type: object
    required:
      - content
    properties:
      content:
        type: string

  # Notification Definitions
  RegisterDeviceTokenRequest:
    type: object
    required:
      - token
      - platform
    properties:
      token:
        type: string
      platform:
        type: string
        enum: ["android", "ios", "web"]
      device_info:
        type: string

  SendPushToDeviceRequest:
    type: object
    required:
      - token
      - title
      - body
    properties:
      token:
        type: string
      title:
        type: string
      body:
        type: string
      data:
        type: string
